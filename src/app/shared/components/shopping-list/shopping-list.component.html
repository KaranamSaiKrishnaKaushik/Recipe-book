<div class="row">
  <div class="col-xs-5">
    <app-shopping-list-edit></app-shopping-list-edit>
    <hr>
    <div class="table-container" style="overflow: auto; padding-bottom: 60px;">
      <mat-slide-toggle class="custom-toggle"[(ngModel)]="showAll" (change)="updatePagination()">
        Show All
      </mat-slide-toggle>
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" multiTemplateDataRows>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name
            <input matInput (keyup)="applyColumnFilter($event, 'name')" placeholder="Filter" />
          </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <!-- Amount Column -->
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef> Amount
            <input matInput (keyup)="applyColumnFilter($event, 'amount')" placeholder="Filter" />
          </th>
          <td mat-cell *matCellDef="let element"> {{element.amount}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns" (click)="onEditItem(row.name)"
          class="custom-row"></tr>
      </table>
      <mat-paginator *ngIf="!showAll" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]"
        showFirstLastButtons></mat-paginator>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <button class="btn btn-success" type="submit" (click)="onToMarketPlace()">To Market Place</button>
      </div>
    </div>
    <div class="row">
      <div class="chart-wrapper" *ngIf="orderedItemHistoryList.length>0" style="margin-top:2rem">
        <h4>Spent by Store in Percentages</h4>
        <canvas baseChart [data]="{
        labels: storeLabels,
        datasets: [{
          data: storeSpendings,
          backgroundColor: ['#f44336', '#2196f3', '#4caf50', '#ff9800']
        }]
      }" 
      [type]="'doughnut'" [options]="spendingByStoreOptions">
        </canvas>
      </div>
    </div>
  </div>
  <h1>Shopping History Analysis</h1>
  <div class="col-xs-7" *ngIf="orderedItemHistoryList.length>0">
    <div class="btn-group mb-2">
      <button class="btn btn-outline-primary" (click)="groupBy = 'month'; 
                 prepareSpendingOverTime(orderedItemHistoryList);
                 prepareTopProducts(orderedItemHistoryList);
                 prepareSpendingByStore(orderedItemHistoryList);">
        Monthly
      </button>
      &nbsp;
      <button class="btn btn-outline-primary" (click)="groupBy = 'quarter'; 
                 prepareSpendingOverTime(orderedItemHistoryList);
                 prepareTopProducts(orderedItemHistoryList);
                 prepareSpendingByStore(orderedItemHistoryList);">
        Quarterly
      </button> &nbsp;
      <button class="btn btn-outline-primary" (click)="groupBy = '4months'; 
                 prepareSpendingOverTime(orderedItemHistoryList);
                 prepareTopProducts(orderedItemHistoryList);
                 prepareSpendingByStore(orderedItemHistoryList);">
        Every 4 Months
      </button>
    </div>
    <div class="chart-wrapper">
      <h4>Spending Over Time</h4>
      <canvas baseChart [data]="{
              labels: spendingDates,
              datasets: [{ data: spendingValues, label: '€ Spent' }]
            }" [options]="{ responsive: true }" [type]="'bar'">
      </canvas>
    </div>

    <div class="chart-wrapper" style="margin-top:2rem">
      <h4>Top Products Bought</h4>
      <canvas baseChart [data]="{
              labels: topProductNames,
              datasets: [{ data: topProductCounts, label: 'Times Bought' }]
            }" [options]="{ responsive: true }" [type]="'bar'">
      </canvas>
    </div>

    <div class="chart-wrapper" style="margin-top: 2rem;">
      <h4>Average Price per Category</h4>
      <canvas baseChart [data]="{
            labels: avgPriceCategoryLabels,
            datasets: [{
              data: avgPriceCategoryValues,
              label: 'Avg. Price (€)',
              backgroundColor: '#42a5f5'
            }]
          }" [options]="{
            responsive: true,
            indexAxis: 'y', 
            scales: {
              x: { beginAtZero: true }
            }
          }" [type]="'bar'">
      </canvas>
    </div>


  </div>
  <div class="empty-order-history-container" *ngIf="orderedItemHistoryList.length===0">
    <h2>You have No Order History yet!</h2>
   <br>
   <h2>After your purchases we start doing some analysis on your purchases!</h2>
  </div>
</div>